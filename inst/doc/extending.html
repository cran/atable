<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Alan Haynes" />

<meta name="date" content="2019-11-26" />

<title>Extending atable</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Extending <code>atable</code></h1>
<h4 class="author">Alan Haynes</h4>
<h4 class="date">2019-11-26</h4>



<p><code>atable</code> has been designed for flexibility in mind. If you don’t like the defaults, you can define your own summary statistics, tests and effect measures. You can even define your own methods for classes not supported natively. This vignette gives some details and examples on how to go about these tasks.</p>
<p>In this vignette we will use the <code>mtcars</code> dataset as an example. Load it and prepare factors and other variables. We also set the format_to option to <code>md</code> (markdown) for nicer printing in the vignette.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">data</span>(mtcars)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># factors</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">mtcars<span class="op">$</span>am &lt;-<span class="st"> </span><span class="kw">factor</span>(mtcars<span class="op">$</span>am, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="st">&quot;Automatic&quot;</span>, <span class="st">&quot;Manual&quot;</span>))</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">mtcars<span class="op">$</span>vs &lt;-<span class="st"> </span><span class="kw">factor</span>(mtcars<span class="op">$</span>vs, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="st">&quot;V-shaped&quot;</span>, <span class="st">&quot;straight&quot;</span>))</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># ordered</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">mtcars<span class="op">$</span>cyl &lt;-<span class="st"> </span><span class="kw">ordered</span>(mtcars<span class="op">$</span>cyl)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co"># set format_to</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">atable_options</span>(<span class="dt">format_to =</span> <span class="st">&quot;md&quot;</span>)</a></code></pre></div>
<p>The <code>atable</code> default settings produce the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">atable</span>(vs <span class="op">+</span><span class="st"> </span>cyl <span class="op">+</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span>disp <span class="op">~</span><span class="st"> </span>am, mtcars))</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; Warning in wilcox.test.default(x = c(2, 3, 2, 3, 1, 1, 2, 2, 3, 3, 3, 3, : cannot compute exact p-</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; value with ties</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Warning in stats::ks.test(x, y, alternative = c(&quot;two.sided&quot;), ...): cannot compute exact p-value</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; with ties</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; Warning in stats::ks.test(x, y, alternative = c(&quot;two.sided&quot;), ...): cannot compute exact p-value</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; with ties</span></a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Group</th>
<th align="left">Automatic</th>
<th align="left">Manual</th>
<th align="left">p</th>
<th align="left">stat</th>
<th align="left">Effect Size (CI)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Observations</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">         </td>
<td align="left">19</td>
<td align="left">13</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">vs     </td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     V-shaped</td>
<td align="left">63% (12)</td>
<td align="left">46% (6)</td>
<td align="left">0.56</td>
<td align="left">0.35</td>
<td align="left">2 (0.38; 11)</td>
</tr>
<tr class="odd">
<td align="left">     straight</td>
<td align="left">37% (7)</td>
<td align="left">54% (7)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     missing</td>
<td align="left">0% (0)</td>
<td align="left">0% (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">cyl</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     4</td>
<td align="left">16% (3)</td>
<td align="left">62% (8)</td>
<td align="left">0.0039</td>
<td align="left">194</td>
<td align="left">0.57 (0.18; 0.81)</td>
</tr>
<tr class="odd">
<td align="left">     6</td>
<td align="left">21% (4)</td>
<td align="left">23% (3)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     8</td>
<td align="left">63% (12)</td>
<td align="left">15% (2)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">     missing</td>
<td align="left">0% (0)</td>
<td align="left">0% (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">hp</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">     Mean (SD)</td>
<td align="left">160 (54)</td>
<td align="left">127 (84)</td>
<td align="left">0.038</td>
<td align="left">0.51</td>
<td align="left">0.49 (-0.25; 1.2)</td>
</tr>
<tr class="even">
<td align="left">     valid (missing)</td>
<td align="left">19 (0)</td>
<td align="left">13 (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">disp</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     Mean (SD)</td>
<td align="left">290 (110)</td>
<td align="left">144 (87)</td>
<td align="left">0.0013</td>
<td align="left">0.69</td>
<td align="left">1.4 (0.62; 2.3)</td>
</tr>
<tr class="odd">
<td align="left">     valid (missing)</td>
<td align="left">19 (0)</td>
<td align="left">13 (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<div id="methods-for-other-classes" class="section level2">
<h2>Methods for other classes</h2>
<p><code>atable</code> only support numeric, factor and ordered classes by default. If you want to use unsupported classes, e.g. <code>Date</code> or <code>surv</code>, you can define methods for them reasonably easily.</p>
<div id="example-methods-for-dates" class="section level3">
<h3>Example methods for <code>Date</code>s</h3>
<p>There are no methods for <code>Date</code>s in <code>atable</code>. We can define them easily though. If we want the minimum, median and maximum dates, we could define the statistics function as follows. The class of the output here is important - it is used to choose the appropriate formatting function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># statistics function</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">statistics.Date &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...){</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  out &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">min =</span> <span class="kw">min</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">              <span class="dt">med =</span> <span class="kw">median</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">              <span class="dt">max =</span> <span class="kw">max</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  <span class="kw">class</span>(out) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;statistics_date&quot;</span>, <span class="kw">class</span>(out))</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  out</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">}</a></code></pre></div>
<p>The suitable formatting function for that might be the following to put minimum and maximum on one line followed by the median on the next. The factor is required to avoid reordering the rows.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">format_statistics.statistics_date &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...){</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  z &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Min ; Max&quot;</span>, <span class="st">&quot;Median&quot;</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  out &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">tag =</span> <span class="kw">factor</span>(z, z),</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                    <span class="dt">value =</span> <span class="kw">c</span>(<span class="kw">paste</span>(x<span class="op">$</span>min, x<span class="op">$</span>max, <span class="dt">sep =</span> <span class="st">&quot; ; &quot;</span>),</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                              <span class="kw">as.character</span>(x<span class="op">$</span>med)),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  <span class="kw">return</span>(out)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">}</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># add a date variable to mtcars</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">mtcars<span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="kw">runif</span>(<span class="kw">nrow</span>(mtcars), <span class="dv">0</span>, <span class="dv">365</span><span class="op">*</span><span class="dv">10</span>), <span class="st">&quot;1990-01-01&quot;</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">atable</span>(mtcars, <span class="st">&quot;date&quot;</span>))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Group</th>
<th align="left">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Observations</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">         </td>
<td align="left">32</td>
</tr>
<tr class="odd">
<td align="left">date     </td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     Min ; Max</td>
<td align="left">1991-05-14 ; 1999-10-27</td>
</tr>
<tr class="odd">
<td align="left">     Median</td>
<td align="left">1995-05-31</td>
</tr>
</tbody>
</table>
<p>If comparing two or more groups, then suitable <code>two_sample_htest</code> and <code>multi_sample_htest</code> functions should also be defined.</p>
</div>
<div id="example-methods-for-surv-objects" class="section level3">
<h3>Example methods for <code>surv</code> objects</h3>
<p>Probably more useful than the <code>Date</code> methods would be <code>surv</code> objects, as defined by the <code>survival</code> package.</p>
<p>First we add a <code>surv</code> object to <code>mtcars</code> by creating an observation time point approximately 10 years after the date we defined previously. We then calculate the time between these two time points and define an indicator whether an event occured, in this case the car no longer being road-worthy.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(survival)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co"># add some survival data (use 'date' as the timepoint)</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">mtcars<span class="op">$</span>date2 &lt;-<span class="st"> </span>mtcars<span class="op">$</span>date <span class="op">+</span><span class="st"> </span><span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="kw">nrow</span>(mtcars), <span class="dv">10</span>, <span class="dv">4</span>)) <span class="co"># end date</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">mtcars<span class="op">$</span>time &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(mtcars<span class="op">$</span>date2 <span class="op">-</span><span class="st"> </span>mtcars<span class="op">$</span>date) <span class="co"># time</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">mtcars<span class="op">$</span>not_road_worthy &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="kw">nrow</span>(mtcars), <span class="dv">1</span>, <span class="fl">.2</span>) <span class="co"># 'survived'?</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">mtcars<span class="op">$</span>surv &lt;-<span class="st"> </span><span class="kw">with</span>(mtcars, <span class="kw">Surv</span>(time, not_road_worthy))</a></code></pre></div>
<p>Now we need the appropriate methods for <code>atable</code>. Mean survival time is a common choice for time-to-event analyses. Similarly, the Mantel-Haenszel test is a used to compare two curves.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># statistics function</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">statistics.Surv &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...){</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  survfit_object &lt;-<span class="st"> </span>survival<span class="op">::</span><span class="kw">survfit</span>(x <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="co"># copied from survival::print.survfit</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">  out &lt;-<span class="st"> </span>survival<span class="op">:::</span><span class="kw">survmean</span>(survfit_object, <span class="dt">rmean =</span> <span class="st">&quot;common&quot;</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">mean_survival_time =</span> out<span class="op">$</span>matrix[<span class="st">&quot;*rmean&quot;</span>], </a>
<a class="sourceLine" id="cb7-7" data-line-number="7">              <span class="dt">SE =</span> out<span class="op">$</span>matrix[<span class="st">&quot;*se(rmean)&quot;</span>]))</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co"># testing function</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">two_sample_htest.Surv &lt;-<span class="st"> </span><span class="cf">function</span>(value, group, ...){</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">  survdiff_result &lt;-<span class="st"> </span>survival<span class="op">::</span><span class="kw">survdiff</span>(value<span class="op">~</span>group, <span class="dt">rho=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">  <span class="co"># copy from survival::print.survdiff</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">  etmp &lt;-<span class="st"> </span>survdiff_result<span class="op">$</span>exp</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">  df &lt;-<span class="st"> </span>(<span class="kw">sum</span>(<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(etmp <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">  p &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>stats<span class="op">::</span><span class="kw">pchisq</span>(survdiff_result<span class="op">$</span>chisq, df)</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">p =</span> p,<span class="dt">stat =</span> survdiff_result<span class="op">$</span>chisq))</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">}</a></code></pre></div>
<p>We can then use them with the variables we defined in mtcars…</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">atable</span>(surv <span class="op">~</span><span class="st"> </span>am, mtcars))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Group</th>
<th align="left">Automatic</th>
<th align="left">Manual</th>
<th align="left">p</th>
<th align="left">stat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Observations</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">         </td>
<td align="left">19</td>
<td align="left">13</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">surv     </td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     mean_survival_time</td>
<td align="left">12</td>
<td align="left">15</td>
<td align="left">0.072</td>
<td align="left">3.2</td>
</tr>
<tr class="odd">
<td align="left">     SE</td>
<td align="left">1</td>
<td align="left">1.1</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>An appropriate formatting function could be defined as above for <code>Date</code>s.</p>
</div>
</div>
<div id="different-statistics-for-variables-of-a-single-class" class="section level2">
<h2>Different statistics for variables of a single class</h2>
<p>In the <code>mtcars</code> example, suppose we want to summarize <code>hp</code> by mean and SD and <code>disp</code> by median and quartiles. Mean and SD are the default statistics for numeric variables in <code>atable</code> so we only have to worry about <code>disp</code>. To accomplish this, we can use the same method as we used above for <code>Date</code> variables - we will define new functions for a new class. We will assign the new class, which we will call <code>numeric2</code>, to <code>disp</code> and define new functions to handle it.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># add numeric2 to the class of disp</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">class</span>(mtcars<span class="op">$</span>disp) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;numeric2&quot;</span>, <span class="kw">class</span>(mtcars<span class="op">$</span>disp))</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co"># subsetting function for numeric2 class</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">'[.numeric2'</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x, i, j, ...){</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  y &lt;-<span class="st"> </span><span class="kw">unclass</span>(x)[i, ...]</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="kw">class</span>(y) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;numeric2&quot;</span>, <span class="kw">class</span>(y))</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  y</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">}</a></code></pre></div>
<p>The subsetting function is used to retain the class of the variable (otherwise it reverts to a numeric in this case). We didn’t need to do this above as the relevant function for the <code>Date</code> and <code>surv</code> classes already exist.</p>
<p>Next we define functions to calculate the statistics that we want to use. These both have to return named lists.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># statistics function</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">statistics.numeric2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...){</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  statistics_out &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Median =</span> <span class="kw">median</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                         <span class="dt">p25 =</span> <span class="kw">quantile</span>(x, <span class="fl">0.25</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                         <span class="dt">p75 =</span> <span class="kw">quantile</span>(x, <span class="fl">0.75</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  <span class="kw">class</span>(statistics_out) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;statistics_numeric2&quot;</span>, <span class="kw">class</span>(statistics_out))</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  <span class="co"># We will need this new class later to specify the format</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">  <span class="kw">return</span>(statistics_out)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co"># testing function</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11">two_sample_htest.numeric2 &lt;-<span class="st"> </span><span class="cf">function</span>(value, group, ...){</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">  d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">value =</span> value, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">  test_out &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">wilcox.test</span>(value <span class="op">~</span><span class="st"> </span>group, d)</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">  <span class="kw">return</span>(test_out)</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">}</a></code></pre></div>
<p>Now we can test to see if our new class has been identified and used correctly.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">atable</span>(vs <span class="op">+</span><span class="st"> </span>cyl <span class="op">+</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span>disp <span class="op">~</span><span class="st"> </span>am, mtcars))</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; Warning in wilcox.test.default(x = c(2, 3, 2, 3, 1, 1, 2, 2, 3, 3, 3, 3, : cannot compute exact p-</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; value with ties</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; Warning in stats::ks.test(x, y, alternative = c(&quot;two.sided&quot;), ...): cannot compute exact p-value</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; with ties</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; Warning in wilcox.test.default(x = structure(c(258, 360, 225, 360, 146.7, : cannot compute exact p-</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; value with ties</span></a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Group</th>
<th align="left">Automatic</th>
<th align="left">Manual</th>
<th align="left">p</th>
<th align="left">stat</th>
<th align="left">Effect Size (CI)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Observations</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">         </td>
<td align="left">19</td>
<td align="left">13</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">vs     </td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     V-shaped</td>
<td align="left">63% (12)</td>
<td align="left">46% (6)</td>
<td align="left">0.56</td>
<td align="left">0.35</td>
<td align="left">2 (0.38; 11)</td>
</tr>
<tr class="odd">
<td align="left">     straight</td>
<td align="left">37% (7)</td>
<td align="left">54% (7)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     missing</td>
<td align="left">0% (0)</td>
<td align="left">0% (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">cyl</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     4</td>
<td align="left">16% (3)</td>
<td align="left">62% (8)</td>
<td align="left">0.0039</td>
<td align="left">194</td>
<td align="left">0.57 (0.18; 0.81)</td>
</tr>
<tr class="odd">
<td align="left">     6</td>
<td align="left">21% (4)</td>
<td align="left">23% (3)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     8</td>
<td align="left">63% (12)</td>
<td align="left">15% (2)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">     missing</td>
<td align="left">0% (0)</td>
<td align="left">0% (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">hp</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">     Mean (SD)</td>
<td align="left">160 (54)</td>
<td align="left">127 (84)</td>
<td align="left">0.038</td>
<td align="left">0.51</td>
<td align="left">0.49 (-0.25; 1.2)</td>
</tr>
<tr class="even">
<td align="left">     valid (missing)</td>
<td align="left">19 (0)</td>
<td align="left">13 (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">disp</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     Median</td>
<td align="left">276</td>
<td align="left">120</td>
<td align="left">&lt;0.001</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">     p25</td>
<td align="left">196</td>
<td align="left">79</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     p75</td>
<td align="left">360</td>
<td align="left">160</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>We probably don’t want to have the quartiles beneath the median so we can also define a formatting function. The <code>format_statistics</code> function should return a dataframe with variable tag (as a factor to retain ordering) and value (most likely a string). The class is no longer <code>numeric2</code> but <code>statistics_numeric2</code> as defined in the <code>statistics.numeric2</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">format_statistics.statistics_numeric2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...){</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">tag =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Median [Quartiles]&quot;</span>)),</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">                    <span class="dt">value =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%2.1f [%2.1f ; %2.1f]&quot;</span>, x<span class="op">$</span>Median, x<span class="op">$</span>p25, x<span class="op">$</span>p75),</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">                    <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  <span class="kw">return</span>(out)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">a &lt;-<span class="st"> </span><span class="kw">atable</span>(vs <span class="op">+</span><span class="st"> </span>cyl <span class="op">+</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span>disp <span class="op">~</span><span class="st"> </span>am, mtcars)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; Warning in wilcox.test.default(x = c(2, 3, 2, 3, 1, 1, 2, 2, 3, 3, 3, 3, : cannot compute exact p-</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; value with ties</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; Warning in stats::ks.test(x, y, alternative = c(&quot;two.sided&quot;), ...): cannot compute exact p-value</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; with ties</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt; Warning in wilcox.test.default(x = structure(c(258, 360, 225, 360, 146.7, : cannot compute exact p-</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt; value with ties</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15">knitr<span class="op">::</span><span class="kw">kable</span>(a)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Group</th>
<th align="left">Automatic</th>
<th align="left">Manual</th>
<th align="left">p</th>
<th align="left">stat</th>
<th align="left">Effect Size (CI)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Observations</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">         </td>
<td align="left">19</td>
<td align="left">13</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">vs     </td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     V-shaped</td>
<td align="left">63% (12)</td>
<td align="left">46% (6)</td>
<td align="left">0.56</td>
<td align="left">0.35</td>
<td align="left">2 (0.38; 11)</td>
</tr>
<tr class="odd">
<td align="left">     straight</td>
<td align="left">37% (7)</td>
<td align="left">54% (7)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     missing</td>
<td align="left">0% (0)</td>
<td align="left">0% (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">cyl</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     4</td>
<td align="left">16% (3)</td>
<td align="left">62% (8)</td>
<td align="left">0.0039</td>
<td align="left">194</td>
<td align="left">0.57 (0.18; 0.81)</td>
</tr>
<tr class="odd">
<td align="left">     6</td>
<td align="left">21% (4)</td>
<td align="left">23% (3)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     8</td>
<td align="left">63% (12)</td>
<td align="left">15% (2)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">     missing</td>
<td align="left">0% (0)</td>
<td align="left">0% (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">hp</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">     Mean (SD)</td>
<td align="left">160 (54)</td>
<td align="left">127 (84)</td>
<td align="left">0.038</td>
<td align="left">0.51</td>
<td align="left">0.49 (-0.25; 1.2)</td>
</tr>
<tr class="even">
<td align="left">     valid (missing)</td>
<td align="left">19 (0)</td>
<td align="left">13 (0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">disp</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">     Median [Quartiles]</td>
<td align="left">275.8 [196.3 ; 360.0]</td>
<td align="left">120.3 [79.0 ; 160.0]</td>
<td align="left">&lt;0.001</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># a</span></a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
